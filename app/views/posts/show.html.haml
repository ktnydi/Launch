- @page_title = @post.title
- if errors = @comment.errors.full_messages
  - errors.each do |error|
    .nocomment
      %i#cls-btn.fas.fa-times
      = error
%main
  .container.post_container
    .post_index
      .post_info_wrapper
        .post_info
          .author
            = image_tag gravatar_image(@post.user), size: 50
            %span.name= @post.user.name
          - if user_signed_in?
            - if other_user?(@post.user.uuid)
              %button.follow_btn{data: {id: @post.user.id}}= render "follows/follow", user: @post.user
        .edit_wrapper
          .updated_at= "#{@post.updated_at.strftime("%Y-%m-%d")}に更新"
          - if user_signed_in? && !other_user?(@post.user.uuid)
            %ul.edit_list
              %li= link_to "編集", edit_post_path(@post)
              %li= link_to "削除", post_path(@post), method: :delete, data: { confirm: "本当に削除しますか？一度、記事を削除すると元に戻せなくなります。"}

      %h2.main_title= @post.title
      .user_action
        .heart_btn
          %button.heart#heart
            = render "post", post: @post
        .github_btn
          - if @post.app_url.present?
            %button.github
              = link_to @post.app_url, target: :_blank do
                %i.fab.fa-github
          - else
            %button.github.no_url
              %i.fab.fa-github
        .share_btn#share_btn
          %button.share
            %i.fas.fa-share-alt
    .content
      != markdown @post.content

    .comment_wrapper
      #comment
        = render "comment", comments: @post.comments
:javascript
  var comment_form = document.getElementById('comment_form')
  var comment_area = document.getElementById('comment_area')
  var preview_area = document.getElementsByClassName('preview_area')[0]
  var preview = document.getElementsByClassName('preview')[0]
  var comment_submit = document.getElementById('comment_submit')
  var comment_length = document.getElementsByClassName('comment_length')[0]


  comment_submit.setAttribute('disabled', 'disabled')
  comment_area.addEventListener('input', ()=>{
    preview_area.innerHTML = marked(comment_area.value)
    comment_length.textContent = comment_area.value.length
    if (comment_area.value.length > 0) {
      comment_submit.removeAttribute('disabled')
    } else {
      comment_submit.setAttribute('disabled', 'disabled')
    }
  })

  preview.addEventListener('click', ()=>{
    var icon = preview.children[0]
    icon.classList.toggle('fa-eye-slash')
    icon.classList.toggle('fa-eye')
    comment_form.classList.toggle('hide')
    preview_area.classList.toggle('hide')
  })

  // ssl通信を利用した場合に有効
  if (navigator.share) {
    const share_btn = document.getElementById('share_btn')
    share_btn.classList.add('support')
    share_btn.addEventListener('click', ()=>{
      navigator.share({
        url  : location.href,
        title: document.title,
        text : '',
      })
    })
  }
