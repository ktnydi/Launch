<% if flash[:post_notice] %>
  <div class="post_notice" id="notification">
    <%= flash[:post_notice] %>
  </div>
<% end %>

<div class="posts-home-wrapper">
  <div class="container">
    <aside class="page-left">
      <div class="account-wrapper">
        <h1>ユーザー</h1>
        <div class="account">
          <% if user_signed_in? %>
            <%= image_tag gravatar_image(@user), size: 80 %>
            <div class="current-user-name">
              <%= link_to @user.name, user_posts_path(@user), data: { "turbolinks" => false } %>
            </div>
            <table class="follow">
              <tr>
                <th>
                  <%= link_to "投稿した数", user_myposts_path(@user), data: { "turbolinks" => false } %>
                </th>
                <th>
                  <%= link_to "フォロー", user_myfollows_path(@user), data: { "turbolinks" => false } %>
                </th>
                <th>
                  <%= link_to "フォロワー", user_myfollowers_path(@user), data: { "turbolinks" => false } %>
                </th>
              </tr>
              <tr>
                <td>
                  <%= @user.posts.status_public.count %>
                </td>
                <td>
                  <%= @user.followings.count %>
                </td>
                <td>
                  <%= @user.followers.count %>
                </td>
              </tr>
            </table>
            <% if followings = @user.followings %>
              <div class="follows-lists-wrapper">
                <h3>
                  フォローしているユーザー
                </h3>
                <div class="follows-lists">
                <% followings.limit(12).each do |following| %>
                  <div class="list">
                    <%= image_tag gravatar_image(following), size: 50 %>
                  </div>
                <% end %>
                </div>
                <%= link_to "すべて表示", user_myfollows_path(@user), data: { "turbolinks" => false } %>
              </div>
            <% end %>
          <% else %>
            <%= link_to "ログイン", new_user_session_path, class: "login" %>
            <%= link_to "アカウント作成", new_user_registration_path, class: "signup" %>
          <% end %>
        </div>
      </div>
      <div class="posts-rank-wrapper">
        <div class="period">
          <h3>アクセスランキング</h3>
          <div class="select-period">
            <% if params[:period] %>
              <%= link_to "Day", "?period=today", data: { "turbolinks" => false } %>
            <% else %>
              <%= link_to "Day", "?period=today", data: { "turbolinks" => false }, class: "select" %>
            <% end %>
            <%= link_to "Week", "?period=week", data: { "turbolinks" => false } %>
            <%= link_to "Month", "?period=month", data: { "turbolinks" => false } %>
          </div>
        </div>
        <% if @posts.present? %>
        <div class="posts-list">
          <% @posts.each do |post| %>
          <div class="post">
            <div class="post-title">
              <h2>
                <%= link_to post.title, post_path(post), data: { "turbolinks": false } %>
              </h2>
              <div class="post-bottom">
                <div class="left">
                  <span class="heart">
                    <% if current_user && post.likes.find_by(user_id: current_user.id) %>
                      <i class="fas fa-heart"></i>
                    <% else %>
                      <i class="far fa-heart"></i>
                    <% end %>
                    <%= post.likes.count %>
                  </span>
                  ･
                  <span>
                    Created by
                    <%= post.user.name %>
                  </span>
                </div>
                <p>
                  <%= post.created_at.strftime("%Y.%m.%d") %>
                </p>
              </div>
            </div>
          </div>
          <% end %>
        </div>
        <% else %>
          <p class="noposts">
            期間内に投稿された記事はありません。
          </p>
        <% end %>
      </div>
    </aside>
    <div class="page-right">
      <% if user_signed_in? %>
        <div class="followings-posts-wrapper">
          <div class="followings">
            <h3>新着記事</h3>
          </div>
          <div class="posts-list">
          <% if @following_posts.present? %>
            <% @following_posts.each do |post| %>
              <div class="post">
                <%= image_tag gravatar_image(post.user), size: 50 %>
                <div class="post-title">
                  <div class="post-top">
                    <h2>
                      <%= link_to post.title, post_path(post), data: { "turbolinks": false } %>
                    </h2>
                    <p><%= truncate post.content, length: 120 %></p>
                  </div>
                  <div class="post-bottom">
                    <div class="left">
                      <span class="heart">
                        <% if current_user && post.likes.find_by(user_id: current_user.id) %>
                          <i class="fas fa-heart"></i>
                        <% else %>
                          <i class="far fa-heart"></i>
                        <% end %>
                        <%= post.likes.count %>
                      </span>
                      ･
                      <span>
                        Created by
                        <%= post.user.name %>
                      </span>
                    </div>
                    <p>
                      <%= post.created_at.strftime("%Y.%m.%d %H:%M") %>
                    </p>
                  </div>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="noposts">
              <h2>記事がありません</h2>
              <p>開発したアプリを紹介してコメントをもらおう！</p>
              <%= link_to "アプリを紹介する", new_post_path, data: { turbolinks: false } %>
            </div>
          <% end %>
          </div>
          <div class="paginate">
            <%= link_to_prev_page @following_posts, "前のページへ", class: "prev-page", data: { "turbolinks" => false } %>
            <%= link_to_next_page @following_posts, "次のページへ", class: "next-page", data: { "turbolinks" => false } %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
